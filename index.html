<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quick QR – Generator</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg:#0b1220; --panel:#0f172a; --ink:#e6edf7; --muted:#9fb0c9; --accent:#60a5fa; --border:#1f2a44;
    --radius:16px; --gap:14px; --shadow:0 6px 26px rgba(0,0,0,.25), 0 2px 10px rgba(0,0,0,.2);
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f7f9fc; --panel:#ffffff; --ink:#0b1220; --muted:#5a6b86; --border:#dbe3f2; --accent:#2563eb }
  }
  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; background:radial-gradient(1000px 600px at 20% -10%, rgba(96,165,250,.15), transparent),
    radial-gradient(900px 600px at 120% 10%, rgba(99,102,241,.12), transparent), var(--bg);
    color:var(--ink); font:15px/1.5 ui-sans-serif, system-ui, -apple-system,"Segoe UI",Roboto,Helvetica,Arial;
    letter-spacing:.2px;
  }
  .wrap{ max-width:1100px; margin:24px auto 80px; padding:0 14px }
  .hero{ text-align:center; margin:8px 0 20px; }
  .title{ font-size:clamp(24px,4vw,38px); font-weight:800; margin:0 0 6px }
  .subtitle{ color:var(--muted); margin:0; font-size:clamp(14px,2vw,16px) }
  .grid{ display:grid; grid-template-columns: 1.2fr .9fr; gap:20px; align-items:stretch; }
  @media (max-width:900px){ .grid{ grid-template-columns:1fr; } }
  .card{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); }
  .row{ display:grid; grid-template-columns:1fr; gap:var(--gap) }
  .row.cols-3{ grid-template-columns:1fr 1fr 1fr }
  @media (max-width:600px){ .row.cols-3{ grid-template-columns:1fr } }
  label{ font-weight:600; font-size:13px; color:var(--muted); display:block; margin:0 0 6px }
  input[type="text"], select, input[type="color"]{
    width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:#0000;
    color:var(--ink); outline:none; transition:border-color .15s, box-shadow .15s; font-size:15px;
  }
  input::placeholder{ color:color-mix(in oklab, var(--muted) 60%, transparent) }
  input:focus, select:focus{ border-color:color-mix(in oklab, var(--accent) 60%, var(--border)); box-shadow:0 0 0 4px color-mix(in oklab, var(--accent) 18%, transparent) }
  .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:12px 14px; font-weight:700;
        background:linear-gradient(180deg, color-mix(in oklab, var(--accent) 90%, #fff 10%), var(--accent));
        color:white; border:none; border-radius:12px; cursor:pointer; transition:transform .06s ease }
  .btn:active{ transform:translateY(1px) scale(.995) }
  .btn.secondary{ background:#0000; color:var(--ink); border:1px solid var(--border) }
  .btn.ghost{ background:#0000; color:var(--muted); border:1px dashed var(--border) }
  .btnbar{ display:flex; flex-wrap:wrap; gap:10px }
  .qr-box{ display:grid; place-items:center; border-radius:12px; padding:18px; min-height:360px; border:1px solid var(--border) }
  .qr-wrap{ background:var(--panel); padding:16px; border-radius:12px; border:1px solid var(--border) }
  .qr-wrap canvas, .qr-wrap img{ display:block; height:auto; max-width:100% }
  .note{ color:var(--muted); font-size:13px }
  .footer{ margin-top:18px; color:var(--muted); text-align:center; font-size:12px }
  .spacer{ height:8px }
  .err{ color:#ff6b6b; font-weight:700; }
</style>
</head>
<body>
<div class="wrap">
  <header class="hero">
    <h1 class="title">Quick&nbsp;QR</h1>
    <p class="subtitle">Type a link or any text → get a crisp QR you can copy or download.</p>
    <noscript><p class="err">This page needs JavaScript enabled.</p></noscript>
  </header>

  <div class="grid">
    <!-- Controls -->
    <section class="card">
      <form id="qrForm" autocomplete="on">
        <div class="row">
          <div>
            <label for="text">Text or URL</label>
            <input id="text" type="text" placeholder="https://example.com (or any text)" />
          </div>
        </div>

        <div class="row cols-3" style="margin-top:8px">
          <div>
            <label for="size">Size</label>
            <select id="size">
              <option value="192">192 px</option>
              <option value="256" selected>256 px</option>
              <option value="384">384 px</option>
              <option value="512">512 px</option>
              <option value="768">768 px</option>
              <option value="1024">1024 px</option>
            </select>
          </div>
          <div>
            <label for="ecc">Error correction</label>
            <select id="ecc">
              <option value="L">L (7%)</option>
              <option value="M" selected>M (15%)</option>
              <option value="Q">Q (25%)</option>
              <option value="H">H (30%)</option>
            </select>
          </div>
          <div>
            <label for="margin">Margin</label>
            <select id="margin">
              <option value="0">0 modules</option>
              <option value="2" selected>2 modules</option>
              <option value="4">4 modules</option>
              <option value="8">8 modules</option>
            </select>
          </div>
        </div>

        <div class="row cols-3" style="margin-top:8px">
          <div>
            <label for="fg">Foreground</label>
            <input id="fg" type="color" value="#000000" />
          </div>
          <div>
            <label for="bg">Background</label>
            <input id="bg" type="color" value="#ffffff" />
          </div>
          <div>
            <label>&nbsp;</label>
            <button type="submit" class="btn" id="generateBtn">Generate QR</button>
          </div>
        </div>

        <div class="spacer"></div>
        <div class="btnbar">
          <button type="button" class="btn secondary" id="copyBtn">Copy image</button>
          <button type="button" class="btn secondary" id="pngBtn">Download PNG</button>
          <button type="button" class="btn ghost" id="shareBtn" title="Update the page URL with your settings">Share link</button>
          <span class="note" id="status"></span>
        </div>
      </form>
      <p class="note" style="margin-top:10px">Tip: Press <b>Enter</b> to (re)generate. If it still doesn’t show, check the status line below.</p>
    </section>

    <!-- Output -->
    <section class="card">
      <div class="qr-box">
        <div class="qr-wrap" id="qrcode" aria-live="polite" aria-label="QR code will appear here"></div>
      </div>
      <div class="footer">All generation happens in your browser.</div>
    </section>
  </div>
</div>

<!-- QRCode.js (no SRI; reliable CDN) -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const text   = $('text'), size=$('size'), ecc=$('ecc'), margin=$('margin'), fg=$('fg'), bg=$('bg');
  const form   = $('qrForm'), box=$('qrcode'), status=$('status');
  const copyBtn=$('copyBtn'), pngBtn=$('pngBtn'), shareBtn=$('shareBtn');

  let qr;

  function setStatus(msg, isErr=false){
    status.textContent = msg || '';
    status.className = isErr ? 'note err' : 'note';
  }

  function clearQR(){ box.innerHTML=''; qr=null; }

  function eccMap(v){
    return {L: QRCode.CorrectLevel.L, M: QRCode.CorrectLevel.M, Q: QRCode.CorrectLevel.Q, H: QRCode.CorrectLevel.H}[v] ?? QRCode.CorrectLevel.M;
  }

  function makeQR(){
    const val = text.value.trim();
    if(!val){ setStatus('Enter text or a URL to generate.', true); clearQR(); return; }
    setStatus('');
    clearQR();
    try{
      qr = new QRCode(box, {
        text: val,
        width: +size.value,
        height:+size.value,
        colorDark: fg.value,
        colorLight: bg.value,
        correctLevel: eccMap(ecc.value)
      });
      const canv = box.querySelector('canvas') || box.querySelector('img');
      if (canv){
        const modPad = Number(margin.value);
        const px = Math.round((+size.value)/25 * (modPad/2)); // heuristic for quiet zone
        canv.style.background = bg.value;
        box.style.padding = Math.max(8, px) + 'px';
      }
    }catch(err){
      setStatus('Could not render QR: ' + String(err), true);
    }
  }

  form.addEventListener('submit', (e)=>{ e.preventDefault(); makeQR(); });
  text.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); makeQR(); } });

  copyBtn.addEventListener('click', async ()=>{
    const canvas = box.querySelector('canvas');
    if (!canvas){ setStatus('Generate a QR first.', true); return; }
    try{
      const blob = await new Promise(res=>canvas.toBlob(res, 'image/png'));
      await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
      setStatus('Copied PNG to clipboard ✅');
      setTimeout(()=>setStatus(''), 2000);
    }catch{ setStatus('Copy failed (browser may block). Try Download PNG.', true); }
  });

  pngBtn.addEventListener('click', ()=>{
    const canvas = box.querySelector('canvas');
    if (!canvas){ setStatus('Generate a QR first.', true); return; }
    const a = document.createElement('a');
    a.download = 'qr.png';
    a.href = canvas.toDataURL('image/png');
    a.click();
  });

  shareBtn.addEventListener('click', ()=>{
    const qp = new URLSearchParams();
    if (text.value.trim()) qp.set('t', encodeURIComponent(text.value.trim()));
    qp.set('s', size.value); qp.set('e', ecc.value); qp.set('m', margin.value);
    qp.set('fg', fg.value); qp.set('bg', bg.value);
    const newUrl = location.pathname + '?' + qp.toString();
    history.replaceState(null, '', newUrl);
    setStatus('Link updated — you can share/bookmark this page.');
    setTimeout(()=>setStatus(''), 2500);
  });

  // Deep-link support
  const params = new URLSearchParams(location.search);
  if (params.has('t')) text.value = decodeURIComponent(params.get('t'));
  if (params.has('s')) size.value = params.get('s');
  if (params.has('e')) ecc.value = params.get('e');
  if (params.has('m')) margin.value = params.get('m');
  if (params.has('fg')) fg.value = params.get('fg');
  if (params.has('bg')) bg.value = params.get('bg');
  if (text.value.trim()) makeQR();

  // Surface script-load issues
  window.addEventListener('error', (e)=>{
    if(String(e?.message||'').includes('QRCode')){
      setStatus('QR library failed to load. If you use aggressive content blockers, allow cdn.jsdelivr.net.', true);
    }
  });
})();
</script>
</body>
</html>
